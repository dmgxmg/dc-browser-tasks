(()=>{"use strict";function t(t,e){return fetch(t,{credentials:"same-origin",...e}).then((t=>t.json()))}class e{static of(t=Date.now()){return new this(t instanceof e?t.toDate():t)}static now(){return this.of()}value;constructor(t){this.value=function(t){return"string"==typeof t}(t)?t.replace(/-/g,"/"):t}toDate(){return new Date(this.value)}startOfDay(){return e.of(this.toDate().setHours(0,0,0,0))}endOfDay(){return e.of(this.toDate().setHours(23,59,59,999))}subtractDays(t){return this.addDays(-t)}addDays(t){const s=this.toDate();return e.of(s.setDate(s.getDate()+t))}isBefore(t){return this.compare(t)<0}isAfter(t){return this.compare(t)>0}isSame(t){return 0===this.compare(t)}compare(t){return this.toDate().getTime()-e.of(t).toDate().getTime()}format(t){const e=this.toDate(),s={Y:e.getFullYear(),M:e.getMonth()+1,D:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),S:e.getMilliseconds()};return t.replace(/(Y+|M+|D+|H+|m+|s+|S+)/g,(t=>{const e=t.slice(-1);return String(s[e]).padStart(t.length,"0")}))}dateFormat(t="YYYY-MM-DD"){return this.format(t)}dateTimeFormat(t="YYYY-MM-DD HH:mm:ss"){return this.format(t)}}function s(t,e){const s=new URL(t);return s.search=new URLSearchParams(e).toString(),s.toString()}function a(t){return t.startsWith("//")?(s=t,document.evaluate(s,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):(e=t,document.querySelector(e));var e,s}function n(t){const e={bubbles:!0},s=new TouchEvent("touchstart",e);t.dispatchEvent(s);const a=new TouchEvent("touchend",e);t.dispatchEvent(a)}let r=t=>{t.click()};function o(t){return new Promise((e=>setTimeout(e,t)))}async function i(t){let e=100;for(;;){const s=a(t);if(s)return s;if(--e<=0)return Promise.reject(`Wait for element timeout! Target: [${t}]`);await o(100)}}async function u(t){var e;(e=await i(t)).scrollIntoView({block:"center"}),r(e)}const c=Boolean(window.ReactNativeWebView&&window.ReactNativeWebView.postMessage)?function(t,e){window.ReactNativeWebView.postMessage(JSON.stringify(e?{type:t,payload:e}:{type:t}))}:function(t,e){const s={type:t,payload:e};switch(s.type){case"TaskError":case"TaskResult":alert(s.payload.message)}};function l(t){return e=>c(t,e)}const f=l("TaskStart"),h=l("TaskEnd"),d=l("TaskSuccess"),p=l("TaskError"),m=l("TaskResult"),w=l("TaskStepStart"),y=l("TaskStepEnd"),g=l("TaskDelay");class D{static of(){return new this}static defaultFlowBuilderOptions(){return{delayTimeAfterEachStep:500}}static async delayAndNotify(t){g({delayTime:t}),await o(t)}steps=[];flowBuilderOptions=D.defaultFlowBuilderOptions();constructor(){}setFlowBuilderOptions(t){return this.flowBuilderOptions={...this.flowBuilderOptions,...t},this}step(t,e){return this.steps.push({stepName:e,fn:t}),this}delayStep(t=500,e="DelayStep"){return this.step((()=>D.delayAndNotify(t)),e)}loopStep(t,e,s="LoopStep"){return this.step((async()=>{for(;t();)await e()}),s)}waitClickStep(t,e){return this.step((()=>async function(t){r(await i(t))}(t)),e)}waitViewClickStep(t,e){return this.step((()=>u(t)),e)}build(){return async()=>{const{delayTimeAfterEachStep:t}=this.flowBuilderOptions;for(const[e,{stepName:s,fn:a}]of this.steps.entries()){const n={stepName:s,index:e};w(n),await a(),y(n),await D.delayAndNotify(t)}}}}class S extends D{urls;static of(t=[]){return new this(Array.isArray(t)?t:[t])}static defaultPageFlowOptions(){return{delayTimeBeforeTaskStart:1e3}}taskSuccessFn=()=>!1;pageFlowOptions=S.defaultPageFlowOptions();constructor(t){super(),this.urls=t}useTouchClick(){return r=n,this}setPageFlowOptions(t){return this.pageFlowOptions={...this.pageFlowOptions,...t},this}successWhen(t){return this.taskSuccessFn=t,this}successViewExists(t){return this.successWhen((()=>function(t){const e=a(t);return!!e&&(e.scrollIntoView({block:"center"}),!0)}(t)))}async execute(){if(f(),!this.validatePageUrl())return p({message:"PageInvalid"});if(await S.delayAndNotify(this.pageFlowOptions.delayTimeBeforeTaskStart),this.taskSuccessFn())return d();try{await this.build()(),this.taskSuccessFn()?d():h()}catch(t){p({message:t.message})}}validatePageUrl(){const t=this.urls,e=window.location.href;return!t.length||t.some((t=>e.startsWith(t)))}}function T(t){return{date:t,inAmount:0,outAmount:0}}S.of("https://bean.m.jd.com/beanDetail/index.action").step((async()=>{const a=(await async function(a){const n=e.of(),r=n.subtractDays(a-1).startOfDay();let o=1;const i=[];t:for(;;){const a=s("https://bean.m.jd.com/beanDetail/detail.json",{page:o++}),n=(await t(a)).jingDetailList;for(const{amount:t,date:s,eventMassage:a}of n){const n=e.of(s);if(n.isBefore(r))break t;i.push({amount:Number(t),date:n.dateFormat(),eventMassage:a})}}const u=i.reduce(((t,{date:e,amount:s})=>{let a=t[e];return a||(t[e]=a=T(e)),s>0?a.inAmount+=s:a.outAmount+=s,t}),{});return Array.from({length:a},((t,e)=>{const s=n.subtractDays(e).dateFormat();return u[s]||T(s)}))}(2)).map((({date:t,inAmount:e,outAmount:s})=>`[${t}] 加: ${e} 减: ${-s} 净: ${e+s}`)).join("\n");m({message:a})}),"MainStep").execute().then()})();